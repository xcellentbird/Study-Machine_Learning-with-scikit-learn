출처: [NAVER D2. 04.NDK로 안드로이드에 C++ 끼얹기](https://tv.naver.com/v/15354150#comment_focus)

Deep Learning, VR, AR 등 신기술이 등장하면서, NDK의 필요성이 올라가지 않았나
- 새로운 사용자 가치
- 프라이버시 이슈

NDK란?
- JNI(자바(코틀린)에서 C를 호출할 수 있도록 하는 인터페이스)를 이용하여 안드로이드에서 네이티브 코드를 구동할 수 있게 해주는 Development Kit
- 다양한 아키텍처에 대한 Cross Compile(빌더, 모바일 CPU는 ARM칩으로 명령어 체계가 다르고 다른 바이너리를 필요하지만, 모두 포용하게 하는 것)을 가능하도록 하는 것이 핵심 기능
- 이외에도 안드로이드 SDK를 지원하기 위한 시스템 헤더 및 라이브러리 제공

NDK를 사용하는 이유
1. 성능
> 딥러닝 추론, 이미지 처리 등 높은 성능을 필요로 한다.
> ex) 딥러닝 프레임워크(tf-lite, OnnxRuntime, PytorchMobile)은 NDK를 사용하여 빌드한다.
2. 코드 재사용
> C++ 모듈을 aOS, iOS에서 동시 사용 가능 (Cross Compile)
3. 하드웨어 제어
> 하드웨어 드라이버 제어 ex) OpenGL

단점
1. 이식성 결여: 언제나 모든 플랫폼에서 사용 가능한지를 체크해야한다.
2. 안정성 결여: 네이티브 메소드로 자바 메소드처럼 보호받지 못한다. C++ 특성상 메모리 추적, 포인터 사용 등에 의한 C++버그가 발생한다.
3. 보안에 취약: .so같은 동적 라이브러리의 호출은 자바 시큐리티 매니저의 의도에 반한다.
4. 복잡성 증가: 프로그램을 설계할 때, 프로젝트를 진행할 때, 나중에 유지 보수할 때 복잡할 수 있다.

+) JVM 가상 머신(다양한 기기 환경을 위한)을 위한 ART

작동원리의 예시. GPS를 이용할 경우  
1. ART의 Location Manager: GPS 정보를 가져올 수 있는 매니저. 앱으로부터 GPS 호출을 받는다. 
2. ART에서 JNI를 통해 NDK의 C 동적 라이브러리 libgps.so를 호출한다.
3. libgps.so는 HAL계층의 gps 드라이버에서 gps 정보를 받아온다.

![image](https://user-images.githubusercontent.com/59414764/115902176-1b504c00-a49d-11eb-8ceb-8934c3859889.png)


JNI란?
: C와 Java 사이의 호출할 수 있도록하는 인터페이스. 자바에서 메소드를 선언하면 JVM(자바 가상 머신)을 통해 네이티브에서도 자동으로 선언이된다. 다시 말해서, System.load()를 호출하면 VM이 Native로 선언된 메소드를 로딩한 라이브러리의 native 함수로 연결해준다. 자동으로 된다는 것은 동적임을 의미하고, 자원을 많이 소비한다는 것을 의미한다.  

RegisterNatives
- JNI_OnLoad를 추가해 놓으면 JNI_OnLoad만 연결한다. 즉, 자동으로 호출되는 것을 막아준다.
- 사용자가 직접 네이티브 함수 코드를 자바 클래스의 네이티브 메소드에 연결
- VM이 링크하는 것보다 훨씬 능률적이고 빠르다.  

~~오늘은 여기까지, Java, C++ 지식이 더 필요하다 04-24 ~~  
